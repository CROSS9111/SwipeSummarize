---
description: ソースコードを解析し、適切なMermaid形式の図（シーケンス図、クラス図、ER図）を自動判定して生成します。
---

# Diagram Generation Command

複雑なロジックやクラス構造を可視化するために、ソースコードからMermaid記法の図を生成します。
ソースコードの内容を分析し、最適な図の種類（シーケンス図、クラス図、ER図）を自動的に判定します。

## 実行方法

```bash
/diagram-gen [source]
```

- **source**: 解析対象のファイルまたはディレクトリ

## 実行手順

1. **コード解析とタイプ判定**:
   - 指定されたソースコードを読み込み、その特徴から生成すべき図の種類を自動判定します。
     - **ER図**: `models/` ディレクトリや SQLAlchemy/Pydantic モデル定義が含まれる場合。
     - **シーケンス図**: `services/` や `routers/` など、処理フローや関数呼び出しが主体のコードの場合。
     - **クラス図**: クラス定義や継承関係が複雑な場合、または `types/` などの型定義。

2. **構造抽出**:
   - AST（抽象構文木）解析などを用いて、判定された図の種類に必要な情報を抽出します。
   - **シーケンス図**: 関数呼び出しの連鎖、条件分岐、ループ。
   - **クラス図**: クラス定義、プロパティ、メソッド、継承・依存関係。
   - **ER図**: テーブル名、カラム定義、外部キー制約（リレーション）。

3. **Mermaidコード生成**:
   - 解析結果をMermaid記法に変換します。
   - 可読性を高めるため、適切なコメントやグループ化（subgraph）を行います。

4. **出力**:
   - 判定された図の種類と、生成されたMermaidコードをMarkdown形式で出力します。

## 使用例

```bash
# 認証フロー（自動的にシーケンス図として生成）
/diagram-gen backend/app/services/auth_service.py

# ユーザーモデル（自動的にER図/クラス図として生成）
/diagram-gen backend/app/models/user.py
```
