
# Test Generate Command (Revised)

å¯¾è±¡ã‚³ãƒ¼ãƒ‰ã«å¯¾ã—ã€**ã€Œä»•æ§˜æ›¸ã‚’å…¼ã­ãŸå …ç‰¢ãªå˜ä½“ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã€**ã‚’ä½œæˆã—ã¾ã™ã€‚
ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰è‡ªä½“ã®Docstringã«ã€Œãƒ†ã‚¹ãƒˆãƒžãƒˆãƒªã‚¯ã‚¹ã€ã‚’åŸ‹ã‚è¾¼ã‚€ã“ã¨ã§ã€ã‚³ãƒ¼ãƒ‰ã¨ä»•æ§˜ã®ä¸€è‡´ã‚’ä¿è¨¼ã—ã¾ã™ã€‚

## ã‚³ãƒžãƒ³ãƒ‰ã®ã‚´ãƒ¼ãƒ«

1. **å¯¾è©±çš„ãªä»•æ§˜ç¢ºå®š**: ã‚³ãƒ¼ãƒ‰ç”Ÿæˆå‰ã«ãƒ†ã‚¹ãƒˆè¨ˆç”»ï¼ˆãƒžãƒˆãƒªã‚¯ã‚¹ï¼‰ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨åˆæ„ã™ã‚‹
2. **Executable Documentation**: ã‚³ãƒ¼ãƒ‰ã®å…ˆé ­ã«MDå½¢å¼ã®ãƒ†ã‚¹ãƒˆä»•æ§˜ã‚’è¨˜è¼‰ã—ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨å®Ÿè£…ã‚’ä¸€ä½“åŒ–ã•ã›ã‚‹
3. **å®Œå…¨ãªç¶²ç¾…æ€§**: æ­£å¸¸ç³»ãƒ»ç•°å¸¸ç³»ãƒ»å¢ƒç•Œå€¤ã‚’ç¶²ç¾…ã—ã€ã‚«ãƒãƒ¬ãƒƒã‚¸100%ã‚’ç›®æŒ‡ã™

## ä½¿ç”¨æ–¹æ³•

```
/test-generate [file-path]
```

## å‚ç…§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

> ðŸ“‹ **ä½œæˆæ™‚ã¯ä»¥ä¸‹ã‚’å¿…ãšå‚ç…§ã—ã¦ãã ã•ã„**
>
> - **ãƒ†ã‚¹ãƒˆæˆ¦ç•¥**: [testing-strategy.md](../../docs/development/testing-strategy.md) - ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€DIæ–¹é‡ã€ãƒ¢ãƒƒã‚¯ä½¿ã„åˆ†ã‘
> - **ãƒ†ã‚¹ãƒˆåŸºæº–**: [testing-standards.md](../../docs/development/testing-standards.md) - å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ç¶²ç¾…ãƒžãƒˆãƒªã‚¯ã‚¹ã€å‘½åè¦å‰‡ã€ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™

---

## å®Ÿè¡Œæ‰‹é † (Execution Steps)

### Step 1: è§£æžã¨è³ªå• (Analysis & Inquiry)

å¯¾è±¡ã‚³ãƒ¼ãƒ‰ã‚’æ·±ãèª­ã¿è¾¼ã¿ã€ä»¥ä¸‹ã®è¦ç´ ã‚’ç‰¹å®šã—ã¾ã™ã€‚

- ä¸»è¦ãªãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ï¼ˆæ­£å¸¸ç³»ï¼‰
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã€åˆ†å²æ¡ä»¶
- å¤–éƒ¨ä¾å­˜ï¼ˆDB, APIç­‰ï¼‰
- **ä¸æ˜Žç¢ºãªä»•æ§˜**ï¼ˆä¾‹: å®šæ•°åŒ–ã•ã‚Œã¦ã„ãªã„æœ€å¤§æ–‡å­—æ•°ã€è¨±å®¹ã•ã‚Œã‚‹ç‰¹æ®Šæ–‡å­—ãªã©ï¼‰

**ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**:
ã‚³ãƒ¼ãƒ‰ã‹ã‚‰èª­ã¿å–ã‚Œãªã„ä»•æ§˜ã‚„ã€åˆ¤æ–­ã«è¿·ã†ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãŒã‚ã‚‹å ´åˆã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è³ªå•ã‚’è¡Œã£ã¦ãã ã•ã„**ã€‚

---

### Step 2: ãƒ†ã‚¹ãƒˆãƒžãƒˆãƒªã‚¯ã‚¹ã®ä½œæˆã¨åˆæ„ (Matrix & Agreement)

> âš ï¸ **é‡è¦: ã“ã®æ®µéšŽã§ã¯ã¾ã ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ãªã„ã§ãã ã•ã„ã€‚**

è§£æžçµæžœã«åŸºã¥ãã€ä½œæˆäºˆå®šã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’ä¸€è¦§åŒ–ã—ãŸã€Œãƒ†ã‚¹ãƒˆãƒžãƒˆãƒªã‚¯ã‚¹ã€ã‚’ä½œæˆã—ã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æç¤ºã—ã¦æ‰¿èªã‚’æ±‚ã‚ã¦ãã ã•ã„**ã€‚

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®æç¤ºãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆ

```markdown
ä»¥ä¸‹ã®ãƒ†ã‚¹ãƒˆãƒžãƒˆãƒªã‚¯ã‚¹ã«åŸºã¥ã„ã¦å®Ÿè£…ã‚’é€²ã‚ã¦ã‚ˆã‚ã—ã„ã§ã—ã‚‡ã†ã‹ï¼Ÿ
ä¸è¶³ã—ã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹ã‚„ã€ä»•æ§˜ã¨ç•°ãªã‚‹ç‚¹ãŒã‚ã‚Œã°ã”æŒ‡æ‘˜ãã ã•ã„ã€‚

| ID | ã‚«ãƒ†ã‚´ãƒª | ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å | å…¥åŠ›æ¡ä»¶ (Input) | æœŸå¾…çµæžœ (Expected) | å‚™è€ƒ/æ¤œè¨¼å†…å®¹ |
|:---|:---|:---|:---|:---|:---|
| T001 | æ­£å¸¸ç³» | æœ‰åŠ¹ãƒ‡ãƒ¼ã‚¿ã§ä½œæˆ | å…¨é …ç›®æœ‰åŠ¹å€¤ | Success (Objè¿”å´) | DBä¿å­˜ãŒå‘¼ã°ã‚Œã‚‹ã“ã¨ |
| T002 | ç•°å¸¸ç³» | ãƒ¡ãƒ¼ãƒ«å½¢å¼ä¸æ­£ | "invalid-email" | ValidationError | |
| T003 | å¢ƒç•Œå€¤ | åå‰æœ€å¤§é•· | 255æ–‡å­— | Success | å¢ƒç•Œå€¤ã‚¸ãƒ£ã‚¹ãƒˆ |
| T004 | å¢ƒç•Œå€¤ | åå‰æœ€å¤§é•·è¶…éŽ | 256æ–‡å­— | ValidationError | å¢ƒç•Œå€¤+1 |
| ... | ... | ... | ... | ... | ... |
```

---

### Step 3: ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®å®Ÿè£… (Implementation)

**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ‰¿èª**ï¼ˆã€ŒOKã€ã€Œæ‰¿èªã€ãªã©ï¼‰ã‚’å¾—ãŸã‚‰ã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã—ã¾ã™ã€‚

**åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ†ã‚¹ãƒˆä»•æ§˜æ›¸ã¯ä½œæˆã›ãš**ã€ä»¥ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆã§ã‚³ãƒ¼ãƒ‰å†…ã«ä»•æ§˜ã‚’åŸ‹ã‚è¾¼ã‚“ã§ãã ã•ã„ã€‚

#### å®Ÿè£…ãƒ«ãƒ¼ãƒ«

1. **ãƒžãƒˆãƒªã‚¯ã‚¹ã¨ã®ãƒªãƒ³ã‚¯**: å„ãƒ†ã‚¹ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã®Docstringã«ã€ãƒžãƒˆãƒªã‚¯ã‚¹ã®IDï¼ˆä¾‹: `[T001]`ï¼‰ã‚’å¿…ãšè¨˜è¼‰ã™ã‚‹
2. **ãƒ¢ãƒƒã‚¯ã®å¾¹åº•**: `testing-strategy.md` ã«å¾“ã„ã€DBã‚„å¤–éƒ¨APIã¯å¿…ãšãƒ¢ãƒƒã‚¯åŒ–ã™ã‚‹
3. **ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³**: æˆ»ã‚Šå€¤ã ã‘ã§ãªãã€ãƒ¢ãƒƒã‚¯ã®å‘¼ã³å‡ºã—å›žæ•°ã‚„å¼•æ•°ï¼ˆå‰¯ä½œç”¨ï¼‰ã‚‚æ¤œè¨¼ã™ã‚‹

---

## ãƒ†ã‚¹ãƒˆè¦³ç‚¹ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

ãƒžãƒˆãƒªã‚¯ã‚¹ã‚’ä½œæˆã™ã‚‹éš›ã¯ã€ä»¥ä¸‹ã®è¦³ç‚¹ã‚’ç¶²ç¾…ã—ã¦ãã ã•ã„ã€‚
è©³ç´°ãªãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ [testing-standards.md](../../docs/development/testing-standards.md) ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³3ã€Œãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç¶²ç¾…ãƒžãƒˆãƒªã‚¯ã‚¹ã€ã‚’å‚ç…§ã€‚

### 1. æ­£å¸¸ç³» (Happy Path)

- æœ€ã‚‚ä¸€èˆ¬çš„ãªåˆ©ç”¨ã‚·ãƒŠãƒªã‚ª
- ã‚ªãƒ—ã‚·ãƒ§ãƒ³é …ç›®ãŒã‚ã‚‹å ´åˆ/ãªã„å ´åˆ

### 2. ç•°å¸¸ç³»ãƒ»ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

- **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼**: å¿…é ˆæ¬ è½ã€åž‹é•ã„ã€ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆé•å
- **ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼**: åœ¨åº«ä¸è¶³ã€æ¨©é™ä¸è¶³ã€é‡è¤‡ç™»éŒ²
- **å¤–éƒ¨ä¾å­˜ã‚¨ãƒ©ãƒ¼ (Mock)**: DBæŽ¥ç¶šæ–­ã€APIã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã€500ã‚¨ãƒ©ãƒ¼

### 3. å¢ƒç•Œå€¤ãƒ»ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹

**3ç‚¹åˆ†æž**ã‚’è¡Œã„ã€å¿…ãšãƒžãƒˆãƒªã‚¯ã‚¹ã«å«ã‚ã‚‹ã“ã¨ã€‚

| è¦³ç‚¹     | ãƒ†ã‚¹ãƒˆã™ã¹ãå€¤ã®ä¾‹                    |
| :------- | :------------------------------------ |
| æ–‡å­—åˆ—é•· | æœ€å¤§é•·-1, æœ€å¤§é•·, æœ€å¤§é•·+1            |
| æ•°å€¤     | æœ€å°å€¤, 0, è² ã®å€¤, æœ€å¤§å€¤             |
| ãƒªã‚¹ãƒˆ   | ç©ºãƒªã‚¹ãƒˆ([]), è¦ç´ 1ã¤, è¦ç´ å¤šæ•°, None |
| æ—¥ä»˜     | ã†ã‚‹ã†æ—¥(2/29), å¹´ã¾ãŸãŽ, å¢ƒç•Œæ™‚åˆ»    |

---

## ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰æ§‹é€ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

ãƒ•ã‚¡ã‚¤ãƒ«ã®å†’é ­ã«ã€åˆæ„ã—ãŸãƒ†ã‚¹ãƒˆãƒžãƒˆãƒªã‚¯ã‚¹ã‚’ **Markdown Table** ã¨ã—ã¦è¨˜è¼‰ã—ã¾ã™ã€‚

```python
"""
# Test Specification for UserService

## Test Matrix

| ID   | Category | Case Name            | Input Condition         | Expected Result    | Notes          |
|:-----|:---------|:---------------------|:------------------------|:-------------------|:---------------|
| T001 | Normal   | Create Valid User    | Valid name, email, age  | Success (User Obj) | DB save called |
| T002 | Error    | Invalid Email        | "invalid-email"         | ValidationError    |                |
| T003 | Boundary | Name Max Length      | 255 chars               | Success            | Exact boundary |
| T004 | Boundary | Name Over Max        | 256 chars               | ValidationError    | Boundary +1    |
| T005 | Error    | Missing Required     | email=None              | ValidationError    |                |
| T006 | Error    | DB Connection Error  | Mock raises Exception   | DatabaseError      | Retry 3 times  |

## Coverage Goal

- Branch Coverage: 100% (Required)
- Line Coverage: 100% (Required)
"""

import pytest
from unittest.mock import Mock, patch

# ========================================
# Fixtures
# ========================================

@pytest.fixture
def user_service():
    """UserServiceã®ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£"""
    mock_db = Mock()
    return UserService(db=mock_db)

@pytest.fixture
def valid_user_data():
    """æ­£å¸¸ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£"""
    return {"name": "å±±ç”°å¤ªéƒŽ", "email": "yamada@example.com", "age": 30}

# ========================================
# æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆ
# ========================================

class TestUserServiceHappyPath:
    """UserServiceã®æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆ"""

    def test_create_user_with_valid_data(self, user_service, valid_user_data):
        """
        [T001] æ­£å¸¸ç³»: æœ‰åŠ¹ãªãƒ‡ãƒ¼ã‚¿ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã§ãã‚‹ã“ã¨ã‚’ç¢ºèª
        """
        # Arrange
        user_service.db.save.return_value = User(id=1, **valid_user_data)

        # Act
        result = user_service.create_user(valid_user_data)

        # Assert
        assert result is not None
        assert result.name == valid_user_data["name"]
        user_service.db.save.assert_called_once()

# ========================================
# ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ
# ========================================

class TestUserServiceErrorHandling:
    """UserServiceã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ"""

    def test_create_user_with_invalid_email(self, user_service):
        """
        [T002] ç•°å¸¸ç³»: ä¸æ­£ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ValidationErrorãŒç™ºç”Ÿã™ã‚‹ã“ã¨ã‚’ç¢ºèª
        """
        # Arrange
        invalid_data = {"name": "å±±ç”°å¤ªéƒŽ", "email": "invalid-email", "age": 30}

        # Act & Assert
        with pytest.raises(ValidationError) as exc_info:
            user_service.create_user(invalid_data)

        assert "Invalid email format" in str(exc_info.value)

    def test_create_user_with_database_error(self, user_service, valid_user_data):
        """
        [T006] ç•°å¸¸ç³»: DBæŽ¥ç¶šã‚¨ãƒ©ãƒ¼æ™‚ã«DatabaseErrorãŒç™ºç”Ÿã™ã‚‹ã“ã¨ã‚’ç¢ºèª
        """
        # Arrange
        user_service.db.save.side_effect = SQLAlchemyError("Connection failed")

        # Act & Assert
        with pytest.raises(DatabaseError) as exc_info:
            user_service.create_user(valid_user_data)

        assert "Connection failed" in str(exc_info.value)
        assert user_service.db.save.call_count == 3  # ãƒªãƒˆãƒ©ã‚¤ç¢ºèª

# ========================================
# å¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆ
# ========================================

class TestUserServiceBoundaryValues:
    """UserServiceã®å¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆ"""

    def test_create_user_with_max_length_name(self, user_service):
        """
        [T003] å¢ƒç•Œå€¤: åå‰ãŒæœ€å¤§é•·ï¼ˆ255æ–‡å­—ï¼‰ã§æ­£å¸¸ã«ä½œæˆã§ãã‚‹ã“ã¨ã‚’ç¢ºèª
        """
        # Arrange
        max_name = "ã‚" * 255
        data = {"name": max_name, "email": "test@example.com", "age": 30}
        user_service.db.save.return_value = User(id=1, **data)

        # Act
        result = user_service.create_user(data)

        # Assert
        assert result.name == max_name

    def test_create_user_with_over_max_length_name(self, user_service):
        """
        [T004] å¢ƒç•Œå€¤: åå‰ãŒæœ€å¤§é•·ã‚’è¶…ãˆã‚‹ï¼ˆ256æ–‡å­—ï¼‰å ´åˆã«ValidationErrorãŒç™ºç”Ÿã™ã‚‹ã“ã¨ã‚’ç¢ºèª
        """
        # Arrange
        over_max_name = "ã‚" * 256
        data = {"name": over_max_name, "email": "test@example.com", "age": 30}

        # Act & Assert
        with pytest.raises(ValidationError) as exc_info:
            user_service.create_user(data)

        assert "Name too long" in str(exc_info.value)
```

---

## å®Œäº†æ¡ä»¶

1. **ãƒžãƒˆãƒªã‚¯ã‚¹ã®åˆæ„**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰æ˜Žç¢ºãªæ‰¿èªã‚’å¾—ã¦ã„ã‚‹ã“ã¨
2. **ä»•æ§˜åŸ‹ã‚è¾¼ã¿**: ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã®å†’é ­ã«ã€æœ€æ–°ã®ãƒ†ã‚¹ãƒˆãƒžãƒˆãƒªã‚¯ã‚¹ãŒDocstringã¨ã—ã¦è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã“ã¨
3. **ã‚«ãƒãƒ¬ãƒƒã‚¸**: ãƒ­ã‚¸ãƒƒã‚¯åˆ†å²ã‚’100%ç¶²ç¾…ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨

---

## é‡è¦ãªãƒ«ãƒ¼ãƒ«

> âš ï¸ **å‹æ‰‹ã«ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã‹ãªã„**: å¿…ãšã€Œãƒžãƒˆãƒªã‚¯ã‚¹æç¤ºã€â†’ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰¿èªã€â†’ã€Œã‚³ãƒ¼ãƒ‰ç”Ÿæˆã€ã®é †åºã‚’å®ˆã£ã¦ãã ã•ã„ã€‚

> âš ï¸ **çœç•¥ã—ãªã„**: Docstringå†…ã®ãƒžãƒˆãƒªã‚¯ã‚¹ã¯ã€å°†æ¥ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®ãŸã‚ã«çœç•¥ã›ãšå…¨ä»¶è¨˜è¼‰ã—ã¦ãã ã•ã„ã€‚

> âš ï¸ **æ˜Žç¢ºãªæ‰¿èªãŒå¿…è¦**: ã€Œã¯ã„ã€ã€Œæ‰¿èªã€ã€ŒOKã€ç­‰ã®è‚¯å®šçš„å›žç­”ã‚’å¾—ã‚‹ã¾ã§ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚’é–‹å§‹ã—ãªã„ã§ãã ã•ã„ã€‚
>
